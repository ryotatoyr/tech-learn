# Phase 4 要約：進化：テストとDI（依存性の注入）

このフェーズでは、コードの保守性とテスト容易性を高めるために、DI（依存性の注入）の適用とユニットテストの実装を行いました。

## 学んだこと

### 1. 抽象（インターフェース）への依存
- **概要**: `UserService` が具体的な `UserRepository` クラスに依存していた問題を解消。
- **実装**: `IUserRepository` インターフェースを定義し、`UserService` のコンストラクタでこのインターフェースを受け取るように変更。
- **効果**: `UserService` と `UserRepository` が疎結合になり、DBの実装に依存せずにビジネスロジックを扱えるようになった。

### 2. モックを用いたユニットテスト
- **概要**: データベースを実際に動かさずに、サービスのロジックが正しく動作するかを検証。
- **実装**: `jest.fn()` を用いて `IUserRepository` のモックを作成。`argon2` によるパスワード検証を含めたログイン処理や、ユーザー取得処理のテストケースを作成。
- **効果**: テスト実行が高速になり、DBの状態に左右されない安定したテスト環境を構築できた。

### 3. 型安全性の強化
- **概要**: TypeScriptの型チェックによる潜在的なエラー（`undefined` の可能性）の検知と修正。
- **実装**: `user.password` の存在チェック（ガード節）を追加。
- **効果**: 実行時のエラーを未然に防ぎ、より堅牢なコードになった。

## 初めて登場した用語・概念
- **DI (Dependency Injection)**: 依存オブジェクトを外部から注入する設計パターン。
- **Mock (モック)**: テスト対象が依存しているコンポーネントを模倣するオブジェクト。
- **Guard Clause (ガード節)**: 条件を満たさない場合に早期リターンすることで、メインのロジックを簡潔に保つ手法。
