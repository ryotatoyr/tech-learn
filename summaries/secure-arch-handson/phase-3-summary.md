# Phase 3 要約：セキュリティ強化 (Security Hardening)

Phase 3では、アプリケーションの脆弱性を具体的に修正し、実務レベルの堅牢性を備えたシステムへと強化しました。

## 1. 入力バリデーション (Input Validation)
- **概要**: ユーザーからの入力データが、期待される形式（型、長さ、形式など）であるかを厳格に検証します。
- **実装**: `zod` ライブラリを使用してスキーマを定義し、リクエストを処理する直前にバリデーションを実行しました。
- **効果**: 不正な形式のデータによるシステムエラーや、予期せぬ動作を入り口でシャットアウトできました。

## 2. パスワードの安全な管理 (Password Hashing)
- **概要**: 万が一のデータ漏洩に備え、パスワードを元の文字列が推測できないハッシュ値として保存します。
- **実装**: `argon2` アルゴリズムを採用し、平文保存を完全に廃止しました。ログイン時は `argon2.verify` で照合します。
- **効果**: データベースが盗まれても、利用者の実際のパスワードが解読されるリスクを極限まで低減しました。

## 3. SQLインジェクション対策 (Parameterized Query)
- **概要**: ユーザー入力をクエリに直接埋め込むのをやめ、データベース側に「値」として安全に処理させます。
- **実装**: 文字列連結（`${id}`等）を廃止し、プレースホルダ（`?`）を用いたパラメータ化クエリに修正しました。
- **効果**: 攻撃者がSQL命令を挿入することが不可能になり、DB操作の安全性が担保されました。

## 4. 認証・認可 (Authentication & Authorization)
- **概要**: ログインした本人であることを証明する仕組みを導入し、権限のないユーザーのアクセスを制限します。
- **実装**: `JWT (JSON Web Token)` を導入し、ログイン成功時にトークンを発行。`/user` 取得などの保護されたルートではトークンを必須にしました。
- **効果**: 安全なセッション管理が可能になり、ログイン済みユーザーのみが特定のリソースにアクセスできる状態を実現しました。

## 初めて登場した用語・概念
- **Zod**: TypeScriptと相性の良いスキーマ検証ライブラリです。
- **Argon2**: 最新かつ強力なパスワードハッシュ化アルゴリズムです。
- **Hashing (ハッシュ化)**: データを一定の法則で無意味な文字列に変換する処理です。元のデータには戻せません。
- **Placeholder (プレースホルダ)**: SQL文中で後から値を当てはめるための「?」記号です。
- **JWT (JSON Web Token)**: 署名によって改ざんを検知できる、トークンベースの認証規格です。
- **Authentication (認証)**: 本人であることを確認すること。
- **Authorization (認可)**: 特定の操作権限があるかを確認すること。
