# Phase 2 要約：アーキテクチャの整理 (Layered Architecture)

Phase 2では、1つのファイルに固まっていたコードを役割ごとに分割し、メンテナンスしやすく変更に強い「レイヤードアーキテクチャ」へとリファクタリングしました。

## 1. 責務の分離 (Separation of Concerns)
- **概要**: コードの役割に応じて「受付」「ロジック」「データ操作」の3つの層に分割します。
- **実装**: `src/` 配下に `controllers`, `services`, `repositories` ディレクトリを作成し、クラスを分割しました。
- **効果**: 各ファイルのコード量が減り、どこに何が書いてあるか直感的に把握できるようになりました（可読性の向上）。

## 2. 依存方向の管理
- **概要**: 層の間の呼び出しルール（Controller → Service → Repository）を固定します。
- **実装**: 上位の層が下位の層のインスタンスを保持し、機能を利用する構造にしました。
- **効果**: 下位の層（例：DBの変更）の修正が上位の層に影響しにくくなり、部品の入れ替えやテストが容易な「疎結合」な設計になりました。

## 3. 型定義の活用 (DTO)
- **概要**: 層の間でやり取りされるデータの形式を型として定義します。
- **実装**: `src/types/schemas.ts` にユーザー情報やリクエストの型を定義しました。
- **効果**: 存在しないプロパティへのアクセスなどのミスをコンパイル時点で防げるようになり、開発効率が向上しました。

## 初めて登場した用語・概念
- **Layered Architecture (レイヤードアーキテクチャ)**: 役割ごとに階層を分けてプログラムを構成する設計手法です。
- **Controller**: リクエストの受け取りとレスポンスの返却（外部とのインターフェース）を担う層です。
- **Service**: 業務ルールや複数のデータ操作を組み合わせた「ビジネスロジック」を担う層です。
- **Repository**: データベースへのアクセス（CRUD操作）のみを担う層です。
- **Refactoring (リファクタリング)**: 外から見た動作は変えずに、内部のコード構造を整理・改善することです。
- **DTO (Data Transfer Object)**: データを運ぶための専用オブジェクトです。
- **疎結合**: システムの各部品が互いにあまり依存していない状態。一部の変更が全体に波及しにくくなります。
