# Phase 2: 整理：レイヤードアーキテクチャへの移行 の要約

このフェーズでは、Phase 1の「泥団子」状態のコードを、クリーンで保守性の高い「レイヤードアーキテクチャ」に整理しました。

#### **学習のポイント**

1.  **責務の分離 (Separation of Concerns):**
    *   コードの役割に応じて、以下の3つの層（レイヤー）に分割しました。
        *   **Controller層:** クライアントからのリクエストを受け取り、レスポンスを返すことに専念します。複雑なビジネスロジックは持ちません。
        *   **Service層:** アプリケーションのビジネスロジックを担当します。複数のリポジトリを組み合わせて、ユースケースを実現します。
        *   **Repository層:** データベースとのやり取り（データの取得や保存）に専念します。SQLやORMの詳細はこの層に隠蔽されます。

2.  **依存性の方向:**
    *   依存関係は一方向（`Controller` → `Service` → `Repository`）に限定されます。これにより、`Repository`層を別のデータベース（例: MySQL）に置き換えても、`Controller`層には影響が及ばないなど、変更に強い構造が実現されます。

3.  **DTO (Data Transfer Object) の活用:**
    *   `src/types/schemas.ts`で定義した`zod`スキーマのように、層の間でデータをやり取りするための専用の型（オブジェクト）を定義しました。これにより、各層が必要とするデータが明確になります。

4.  **保守性と可読性の向上:**
    *   各ファイル・クラスの役割が明確になったことで、コードの見通しが良くなり、どこを修正・追加すればよいかが格段に分かりやすくなりました。
    *   各層が独立しているため、テストが書きやすくなります。（これはPhase 4で実践します）

このフェーズを通じて、コードを適切に「分割」し、「整理」することの重要性を学びました。これにより、アプリケーションの品質、保守性、そしてセキュリティの基盤が大きく向上しました。
